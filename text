*** Keywords ***
Acquire Token With Error Handling
    Log To Console    \n--- Acquiring Token ---
    ${status}    ${token}=    Run Keyword And Ignore Error    Get Token
    ${token}=    Set Variable If    '${status}'=='PASS'    ${token}    NONE
    Set Suite Variable    ${TOKEN}    ${token}
    Run Keyword If    '${status}'=='FAIL'    Log    Token fetch failed, continuing without token.
    Log To Console    TOKEN = ${TOKEN}

Get Token
    Create Session    auth    https://api.example.com    verify=False
    ${resp}=    GET On Session    auth    /token
    Should Be Equal As Integers    ${resp.status_code}    200
    ${json}=    Evaluate    resp.json()    resp=${resp}
    RETURN    ${json["token"]}






*** Settings ***
Library    RequestsLibrary
Library    BuiltIn
Suite Setup    Acquire Token With Error Handling
Resource    token_keywords.robot

*** Test Cases ***

Test Case A - Validate Token
    [Documentation]    Test A should run first, but even if it fails, B must run.
    Log To Console    \nRunning Test A...
    Should Not Be Equal    ${TOKEN}    NONE
    Log To Console    Token in Test A: ${TOKEN}

Test Case B - Must Run Always
    [Documentation]    Test B runs even if A fails or token acquisition fails.
    Log To Console    \nRunning Test B...
    Log To Console    Token in Test B: ${TOKEN}
    # Simulated test action
    Log To Console    Test B executed successfully.




*** Settings ***
Suite Setup    Acquire Token With Error Handling
Resource       token_keywords.robot
Library        BuiltIn

*** Variables ***
${A_STATUS}    NONE
${B_STATUS}    NONE

*** Test Cases ***

Test Case A - Can Fail
    [Documentation]    Test Case A runs first. If it fails, Test Case B must still run.
    Log To Console    Running Test Case A...
    # This assertion may fail depending on token availability
    ${result}=    Run Keyword And Ignore Error    Should Not Be Equal    ${TOKEN}    NONE
    ${A_STATUS}=    Set Variable    ${result[0]}
    Set Suite Variable    ${A_STATUS}    ${A_STATUS}
    Log To Console    Finished Test Case A with status: ${A_STATUS}

Test Case B - Always Runs
    [Documentation]    Test Case B must run even if Test Case A fails.
    Log To Console    Running Test Case B...
    Log To Console    Token used in Test Case B: ${TOKEN}
    Log To Console    Test Case B executed regardless of Test Case A result.
    Set Suite Variable    ${B_STATUS}    PASSED

Test Case C - Validate Rule A Failed → B Executed
    [Documentation]    Validates: Test A failed, Test B should have executed.
    Log To Console    Running Test Case C...
    Log To Console    A Status = ${A_STATUS}
    Log To Console    B Status = ${B_STATUS}

    # If A failed, B must be PASSED
    Run Keyword If    '${A_STATUS}'=='FAIL' and '${B_STATUS}'=='PASSED'    
    ...    Log To Console     Validation Passed: A failed and B executed.

    # If A failed but B did NOT run → FAIL test
    Run Keyword If    '${A_STATUS}'=='FAIL' and '${B_STATUS}'!='PASSED'
    ...    Fail     Validation Failed: A failed but B did NOT execute!

    # If A passed, B behavior is normal
    Run Keyword If    '${A_STATUS}'=='PASS'
    ...    Log To Console     A Passed → B executed as expected.






    *** Settings ***
Library    SSHLibrary
Library    Process

*** Variables ***
${HOST}        192.1.1.1

${USER}        ec2-user
${PASSWORD}    MyPassword123
${LOG_FILE}    /var/log/messages

*** Test Cases ***
Run Curl And Verify Logs On Linux
    [Documentation]    SSH to server → run curl → verify logs.
    
    Open Connection    ${HOST}
    Login              ${USER}    ${PASSWORD}

    # 1) Run CURL command
    ${curl_output}=    Execute Command    curl -I https://google.com
    Log To Console     CURL Output:\n${curl_output}

    # 2) Verify CURL command success
    Should Contain     ${curl_output}     HTTP/2

    # 3) Check Linux log file
    ${log}=    Execute Command    tail -n 20 ${LOG_FILE}
    Log To Console     Latest Logs:\n${log}

    # 4) Verify log content
    Should Contain Any    ${log}    error    failed    warning

    Close Connection





Wait Until Keyword Succeeds    10x    1s    Wait For New Tab

Switch To Latest Tab









